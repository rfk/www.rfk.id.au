<!doctype html>
<html>
  <head>
    <title>RFK.id.au BrowserID Authentication</title>
  </head>
  <body>
    <script src="http://code.jquery.com/jquery-1.8.1.min.js"></script>
    <script src="https://login.persona.org/authentication_api.js"></script>
    <script src="./bidbundle.js"></script>
    <script src="./personalIDP.js"></script>
    <script type="text/javascript">
    var authEmail = null;

    // If we're already authenticated then there's
    // no need to display the form.
    navigator.id.beginAuthentication(function(email) {
        authEmail = email;
        personalIDP.checkIfAuthenticated({
            "email": email,
            "success": function() {
                navigator.id.completeAuthentication();
            },
            "error": function() {
               $("#browserid-auth-form").show();
            }
        });
    });

    // Otherwise, proceed with the form and set up a
    // callback to authenticate when it is submitted.
    $(function() {
       $("#browserid-auth-form").submit(function(evt) {
           evt.preventDefault();
           personalIDP.authenticate({
               "email": authEmail,
               "password": $("#browserid-auth-password").val(),
               "error": function(err) {
                    navigator.id.raiseAuthenticationFailure(err);
               },
               "success": function() {
                   navigator.id.completeAuthentication();
               }
           });
           return false;
       });
    });
    </script>
    <form id="browserid-auth-form" target="#" style="display: none">
    BrowserID Password: <input type="password" id="browserid-auth-password" />
    <br/><input type="submit" value="Authenticate" />
    </form>
  </body>
</html>
