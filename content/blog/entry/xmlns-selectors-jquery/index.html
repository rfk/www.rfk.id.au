---
title: >
 XML Namespace Selectors for jQuery
slug: xmlns-selectors-jquery
created: !!timestamp '2009-05-22 00:03:27.819312'
modified: !!timestamp '2009-05-22 00:16:02.966747'
tags: 
    - software
    - javascript
---

{% mark excerpt %}<p>I hit my first real roadbump with <a href="http://www.jquery.com/">jQuery</a>
yesterday, a missing feature that really made me stop and stare in puzzlement:
jQuery doesn't support xml-namespace selectors.  Since I'm trying to parse <a href="http://en.wikipedia.org/wiki/WebDAV">WebDAV</a> response bodies, and such documents make extensive use of namespaces, it's quite the issue for me.  Or rather, it <i>was</i> quite the issue &ndash; read on if you're interested in the details, or just <a href="/static/scratch/jquery.xmlns.js">download my solution</a> if you're impatient.</p>

<p>Oh sure, jQuery supports <i>prefix</i> selectors just fine.  If your
document contains an element &lt;D:response&gt;, you can quite safely query
for that element by name as long as you remember to backslash-escape the colon:</p>

<p class="code lang-javascript">$(doc).find("D\\:response")</p>

<p>This works as long as you can guarantee that a single prefix is used for
the target namespace, and that it's used uniformly throughout the document.  But
the <a href="http://www.w3.org/TR/REC-xml-names/">XML Namespaces standard</a>,
as well as the <a href="http://www.ietf.org/rfc/rfc2518.txt">WebDAV
standard</a>, make it very clear that you can't rely on this in general.
 The node name prefix is a purely syntactic construct, while its actual
 namespace is a semantic property that can be specified in several different
 ways.</p>

<p>Fortunately, the <a href="http://www.w3.org/TR/css3-selectors/">CSS Level 3</a> standard provides a very clear syntax and semantics for namespace-aware queries.  After declaring 'D' to be the proper WebDAV namespace URI, the CSS-3 equivalent to the above prefix query would be:</p>{% endmark %}

<p class="code lang-javascript">$(doc).find("D|response")</p>

<p>Unfortunately, this syntax is largely still a pipe-dream.  Not only is it missing from jQuery, but I couldn't find another implementation to help get me off the ground.  The only thing for it was to implement it myself &ndash; so about six hours later, after studying the internals of the <a href="http://www.sizzlejs.com/">Sizzle selector engine</a> and adventuring from <i>getElementsByTagNameNS</i> through to XPath's <i>namespace-uri()</i> and <i>local-name()</i> functions, I have a solution that I'm happy to show to the world: <a href="/static/scratch/jquery.xmlns.js">jquery.xmlns.js</a>.</p>

<p>This plugin extends the jQuery tag and attribute query functions to allow an optional namespace selector.  In the simplest case you declare a namespace prefix in the <i>$.xmlns</i> object, then just query for it as normal:</p>

<p class="code lang-javascript">$.xmlns["D"] = "DAV:";
$(doc).find("D|response").each(...);
</p>

<p>Sadly, the namespace declarations need to be global since the underlying jQuery/Sizzle selector machinery is stateless.  If you're anything like me, such globals will offend your delicate programming sensibilities.  To perform a namespace-based query and automatically clean up when you're done, you can use the <i>xmlns</i> query method as follows:</p>

<p class="code lang-javascript">$(doc).xmlns({D:"DAV:"},function() {
  //  The 'D' namespace is declared within this function
  return this.find("D|response").each(...);
  //  and removed again when the function exits
});
</p>

<p>It's also possible to specify a default namespace, which will be used when no explicit selector is given.  Just pass a string rather than a mapping object, like so:</p>

<p class="code lang-javascript">$(doc).xmlns("DAV:",function() {
  //  This only searches within the 'DAV:' namespace
  return this.find("response").each(...);
});
</p>

<p>Namespaced attribute selectors are also supported, although there are some restrictions as spelled out <a href="http://www.w3.org/TR/css3-selectors/#attrnmsp">here</a>.  The following would search for elements with a 'href' attribute in any namespace:</p>

<p class="code lang-javascript">$(doc).find("[*|href]");
</p>

<p>Of course, there are plenty of caveats here.  I've tested this on Firefox and IE7 and it meets my expectations, but I haven't explored any of the bizarre corner cases that I'm sure are lurking out there.  I also haven't done any performance testing, although I have tried hard not to slow down the common case where a namespace selector is not specified.  I'm far from an expert here &ndash;  any bug reports, success reports or general suggestions most welcome!</p>

<p>Now, to actually get on with the job I was supposed to be doing yesterday...</p>